<div class="vehicles-grid">
  {% for m in rows %}
  <div class="vehicle-card glass-card">
    <!-- Image Section -->
    <div class="vehicle-image">
      {% set image_url = '' %}
      {% if m.listing.raw and m.listing.raw.images and m.listing.raw.images|length > 0 %}
        {% set image_url = m.listing.raw.images[0] %}
      {% elif m.listing.raw and m.listing.raw.photos %}
        {% if m.listing.raw.photos is string %}
          {# Cars.com legacy format - photos is JSON string #}
          {% set image_url = m.listing.raw.photos.replace('[', '').replace(']', '').split(',')[0].strip('"') %}
        {% elif m.listing.raw.photos|length > 0 %}
          {# Cars.com photos as array #}
          {% set image_url = m.listing.raw.photos[0] %}
        {% endif %}
      {% endif %}
      
      {% if image_url and image_url != '' %}
        {% if 'fbcdn.net' in image_url %}
          {# Facebook images get blocked by CORS, use placeholder for now #}
          <div class="image-placeholder">
            ðŸš—
          </div>
        {% else %}
          <img src="{{ image_url }}" alt="{{ m.listing.year }} {{ m.listing.make }} {{ m.listing.model }}" onerror="this.src='/static/placeholder-car.jpg'" loading="lazy" crossorigin="anonymous">
        {% endif %}
      {% else %}
        <div class="image-placeholder">
          ðŸš—
        </div>
      {% endif %}
      
      <!-- Category Badge -->
      <div class="category-badge {{ m.category.lower() }}">
        {{ m.category }}
      </div>
      
      <!-- Margin Badge -->
      <div class="margin-badge">
        {{ "{:.1%}".format(m.margin_percent or 0) }}
      </div>
    </div>
    
    <!-- Content Section -->
    <div class="vehicle-content">
      <!-- Title -->
      <h3 class="vehicle-title">
        {{ m.listing.year }} {{ m.listing.make }} {{ m.listing.model }}
        {% if m.listing.trim %}<span class="vehicle-trim">{{ m.listing.trim }}</span>{% endif %}
      </h3>
      
      <!-- Price and Mileage -->
      <div class="vehicle-basics">
        <div class="vehicle-price">${{ "{:,}".format(m.listing.price) }}</div>
        <div class="vehicle-mileage">
          {% if m.listing.mileage and m.listing.mileage != 0 %}
            {{ "{:,}".format(m.listing.mileage|int) }} miles
          {% endif %}
        </div>
      </div>
      
      <!-- Financial Details -->
      <div class="financial-section">
        <div class="financial-row">
          <span class="financial-label">Shipping</span>
          <span class="financial-value">${{ "{:,}".format(m.shipping_cost or 0) }}</span>
        </div>
        <div class="financial-row">
          <span class="financial-label">Reconditioning</span>
          <span class="financial-value">${{ "{:,}".format(m.recon_cost or 0) }}</span>
        </div>
        <div class="financial-row">
          <span class="financial-label">Packaging</span>
          <span class="financial-value">${{ "{:,}".format(m.pack_cost or 0) }}</span>
        </div>
        <div class="financial-row total">
          <span class="financial-label">Total Cost</span>
          <span class="financial-value">${{ "{:,}".format(m.total_cost or 0) }}</span>
        </div>
      </div>
      
      <!-- Benchmark and Adjustments -->
      {% if m.appraisal %}
      <div class="financial-section">
        <div class="financial-row">
          <span class="financial-label">Benchmark</span>
          <span class="financial-value">${{ "{:,}".format(m.appraisal.benchmark_price) }}</span>
        </div>
        
        {% if m.explanations and m.explanations.mileage and m.explanations.mileage.adjustment %}
        <div class="financial-row">
          <span class="financial-label">Mileage Adj.</span>
          {% set adj = m.explanations.mileage.adjustment %}
          <span class="financial-value adjustment {{ 'positive' if adj > 0 else 'negative' if adj < 0 else 'neutral' }}">
            {% if adj < 0 %}
              {{ "${:,}".format(adj) }}
            {% elif adj > 0 %}
              +{{ "${:,}".format(adj) }}
            {% else %}
              $0
            {% endif %}
          </span>
        </div>
        {% endif %}
        
        {% if m.explanations and m.explanations.totals and m.explanations.totals.adjusted_benchmark %}
        <div class="financial-row total">
          <span class="financial-label">Adj. Benchmark</span>
          <span class="financial-value">${{ "{:,}".format(m.explanations.totals.adjusted_benchmark|int) }}</span>
        </div>
        {% endif %}
      </div>
      {% endif %}
      
      <!-- Profit Margin -->
      <div class="profit-section">
        <div class="profit-amount">${{ "{:,}".format(m.gross_margin_dollars or 0) }}</div>
        <div class="profit-label">Projected Profit</div>
      </div>
      
      <!-- Action Button -->
      <a href="{{ m.listing.url }}" target="_blank" class="view-listing-btn">
        View Listing â†’
      </a>
    </div>
  </div>
  {% endfor %}
</div>

<!-- No additional styles needed - using modern-styles.css -->